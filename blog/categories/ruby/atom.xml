<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Ruby | JT's Blog]]></title>
  <link href="http://rt-tong.com/blog/categories/ruby/atom.xml" rel="self"/>
  <link href="http://rt-tong.com/"/>
  <updated>2017-05-29T16:25:57+08:00</updated>
  <id>http://rt-tong.com/</id>
  <author>
    <name><![CDATA[James Tong]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Ruby Each / Map / Collect]]></title>
    <link href="http://rt-tong.com/blog/2017/05/26/ruby-block-map-collect/"/>
    <updated>2017-05-26T13:51:46+08:00</updated>
    <id>http://rt-tong.com/blog/2017/05/26/ruby-block-map-collect</id>
    <content type="html"><![CDATA[<!-- more -->


<h2>Map / Collect</h2>

<p>一般來說，會把這兩個視為同一種功能，也有說法是map 是collect 的別名</p>

<p>stackoverflow 有針對 map 和 collect 做 benchmark，<strong>使用 map 效能會比較好</strong></p>

<p>map 和 collect 是屬於 Enumerable Module 的 methods</p>

<p>map 和 collect 會回傳新的 array，而 array 內的值是 block 執行的結果</p>

<p>Array、Hash 都有include enumerable module，就可以使用map 和 collect</p>

<pre><code class="ruby"># Array
[1,2,3].map {|x| x + 1 }
# =&gt; [2, 3, 4]

# Hash
hash = {:name =&gt; "John", :age =&gt; 30, :phone =&gt; "0910111000"}
hash.map {|key, value| value }
# =&gt; ["John", 30, "0910111000"]
</code></pre>

<h2>&amp;: 是block 在簡化的符號</h2>

<p>在Rails 中，假設要取得所有User 的姓名，使用map 的寫法如下</p>

<pre><code class="ruby">names = User.all.map{ |user| user[:name] }.compact
# compact: Returns a copy of self with all nil elements removed.
</code></pre>

<p>但如果只針對 Array 中的取某個值或是執行某個 method 就可以使用 <code>&amp;:</code></p>

<pre><code class="ruby"># 取值
names = User.all.map(&amp;:name)

# 轉大寫
["vanessa", "david", "thomas"].map(&amp;:upcase)
#=&gt; ["VANESSA", "DAVID", "THOMAS"]
</code></pre>

<h2>跟 each 差別在哪呢？</h2>

<p>看完 map, collect 感覺跟一般常用的 each 很像，那他們的差別在哪邊呢？</p>

<p>首先 Array、Hash 都有各自實作 <code>#each</code></p>

<p>執行的方式，跟執行 block 的動作是一樣的</p>

<p><strong>主要差別在 each 是回傳self (Array、Hash)，而map 和 collect 回傳 new array</strong></p>

<h2>References</h2>

<ul>
<li><a href="http://motion-express.com/blog/20141010-ruby-block-map-collect">常見 block 說明和應用：do, map, collect</a></li>
<li><a href="http://stackoverflow.com/questions/1217088/what-does-mapname-mean-in-ruby">what-does-mapname-mean-in-ruby</a></li>
<li><a href="http://stackoverflow.com/questions/5254732/difference-between-map-and-collect-in-ruby">difference-between-map-and-collect-in-ruby</a></li>
<li><a href="https://stackoverflow.com/questions/12084507/what-does-the-map-method-do-in-ruby">what-does-the-map-method-do-in-ruby</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RSpec]]></title>
    <link href="http://rt-tong.com/blog/2017/05/23/rspec/"/>
    <updated>2017-05-23T11:32:44+08:00</updated>
    <id>http://rt-tong.com/blog/2017/05/23/rspec</id>
    <content type="html"><![CDATA[<!-- more -->


<h2>介紹</h2>

<ul>
<li>用來測試 Ruby / Rails 的測試工具</li>
<li>程式開發過程，可以確保程式的正確性，也可以讓開發人員有效的重構</li>
<li>當成一種程式文件</li>
</ul>


<h2>慣例</h2>

<ol>
<li>一個 <em>.rb 要搭配同名的 </em>_spec.rb</li>
<li><code>#method</code> 表示 instance method, <code>.method</code> 表示class method</li>
<li>在 Rails 寫 RSpec 建議順序 Model > Controller > View</li>
</ol>


<h2>安裝</h2>

<pre><code class="ruby"># Gemfile
group :development, :test do
  gem 'rspec-rails'
end

$ rails generate rspec:install
</code></pre>

<p>設定取消自動產生 rspec</p>

<pre><code># config/application.rb

class Application &lt; Rails::Application
  config.generators do |g|
    g.controller_specs false
    g.model_specs false
    g.view_specs false
    g.helper_specs false
    g.routing_specs false
    g.request_specs false
  end
end
</code></pre>

<h2>測試指令</h2>

<ul>
<li><code>rspec</code> 全部測試</li>
<li><code>rspec spec/controllers</code> 整個資料夾測試</li>
<li><code>rspec filename_spec.rb</code> 單一檔案測試</li>
<li><code>rspec filename_spec.rb:linenumber</code> 執行某行之後的測試</li>
</ul>


<h2>輸出</h2>

<p>預設不產出文件</p>

<ul>
<li>產生document 並輸出 specdoc  文件
<code>
$ rspec spec --format documentation --out rspec_result.txt
$ rspec spec -fd -o rspec_result.txt
</code></li>
<li>輸出 html 文件
<code>
$ rspec spec --format html --out rspec_result.html
$ rspec spec -fh -o rspec_result.html
</code></li>
</ul>


<h2>Describe / Context / it</h2>

<p>RSpec 的主要區塊，所有的測試都寫在 describe 裡面，裡面則包含多個 context、it 測試</p>

<p>descirbe 超過 40 個字，就需要使用 context、it 分段，讓你的測試更明確、有條理，保持可讀性</p>

<h2>Before &amp; After</h2>

<p>同unit test 的setup 與teardown</p>

<ul>
<li>before(:each) 每段it之前執行</li>
<li>before(:all)  整段describe前只執行一次</li>
<li>after(:each)  每段it之後執行</li>
<li>after(:all)   整段describe後只執行一次</li>
</ul>


<h2>let &amp; let!</h2>

<ul>
<li>let 用到的時候再會被執行</li>
<li>let! 每個測試前都會執行</li>
</ul>


<p>建議用 let 代替 before 來建立 instance variable</p>

<p>因為 let 有 lazy load 特性，只在測項第一次用到該 variable 時被執行，並且會 cache 直到該測項結束</p>

<p>這個技巧在產生 database 內容以測試 query 和 scope 時十分好用</p>

<h2>Stubs</h2>

<p>Stub: For replacing a method with code that returns a specified result.</p>

<ul>
<li>用stub 假造 method，讓它忽略這個 method，或是指定回傳東西，可以避免在測試時，測試不必要的東西。</li>
<li>專注於要測試的東西，如果 method 有呼叫其他 method 就可以 stub 掉</li>
<li>製造假物件，指定這個假物件能回應哪些訊息，還有對應的回傳值，讓要測試的主角，在執行過程中一些地方，能獲得一致的結果</li>
<li>要測試的 model</li>
</ul>


<h2>Mocks</h2>

<p>Mock: A stub with an expectations that the method gets called.</p>

<ul>
<li>假造 method，不只忽略這個 method ，並且期望被呼叫到</li>
<li>「模擬」與一個「協作者」的互動，設立一個「會收到指定訊息」的期望，去驗證互動是否真的有發生。</li>
<li>簡單來說 mock 就是 stub + expectation , 說它是 stub 是因為它也可以像 stub 一樣偽造方法, 阻斷對原來方法的調用, expectation 是說它不僅偽造了這個方法,它還期望你(必須)調用這個方法,如果沒有被調用到,這個 test 就 fail 了</li>
<li>一樣製造假物件，但是現在我們改對這個假物件斷言，在主角的執行過程中，應該要收到什麼訊息、收到的訊息應該夾帶什麼參數、訊息收到的次數…等等，但是會有程式碼的流程些微不自然的問題（準備、斷言、（準備）、執行）</li>
</ul>


<p>使用 mock objects，在 RSpec 裡面叫做 double（替身），來取代「外部邏輯」資料</p>

<pre><code># 讓 Post.save 失敗
allow_any_instance_of(Post).to receive(:save).and_return(false)

# 讓 Post.update 失敗
allow_any_instance_of(Post).to receive(:update).and_return(false)
</code></pre>

<h2>Controller Specs</h2>

<p>Examples
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="n">rails_helper</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;describe TeamsController, :type =&gt; :controller do</span>
</span><span class='line'><span class="sr">  describe &amp;ldquo;GET index&amp;rdquo; do</span>
</span><span class='line'><span class="sr">    it &amp;ldquo;assigns @teams&amp;rdquo; do</span>
</span><span class='line'><span class="sr">      team = Team.create</span>
</span><span class='line'><span class="sr">      get :index</span>
</span><span class='line'><span class="sr">      expect(assigns(:teams)).to eq([team])</span>
</span><span class='line'><span class="sr">    end&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">it</span> <span class="s2">&quot;renders the index template&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">get</span> <span class="ss">:index</span>
</span><span class='line'>  <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/code&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Matchers</p>

<ul>
<li><p>render_template
<code>
expect(response).to render_template(:new)
</code></p></li>
<li><p>redirect_to
<code>
expect(response).to redirect_to(location)
</code></p></li>
<li><p>have_http_status
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_http_status</span><span class="p">(</span><span class="ss">:created</span><span class="p">)</span><span class="o">&lt;</span><span class="sr">/p&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/ul&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;success 就有四種寫法 XD&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_http_status</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'><span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</span><span class='line'><span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_http_status</span><span class="p">(</span><span class="ss">:ok</span><span class="p">)</span>
</span><span class='line'><span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_http_status</span><span class="p">(</span><span class="ss">:success</span><span class="p">)</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;page not found&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">have_http_status</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></p>

<ul>
<li>be_a_new
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">assigns</span><span class="p">(</span><span class="ss">:widget</span><span class="p">)</span> <span class="err">表示</span> <span class="n">action</span> <span class="err">要回傳的</span> <span class="vi">@widget</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;h1&gt;be_a_new 只是否等同 Widget.new&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="n">expect</span><span class="p">(</span><span class="n">assigns</span><span class="p">(</span><span class="ss">:widget</span><span class="p">))</span><span class="o">.</span><span class="n">to</span> <span class="n">be_a_new</span><span class="p">(</span><span class="no">Widget</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></p></li>
</ul>


<h2>Model Specs</h2>

<p>Examples</p>

<p>使用 reload 重新載入資料</p>

<pre><code class="ruby">require "rails_helper"

describe Post, :type =&gt; :model do
  context "with 2 or more comments" do
    it "orders them in reverse chronologically" do
      post = Post.create!
      comment1 = post.comments.create!(:body =&gt; "first comment")
      comment2 = post.comments.create!(:body =&gt; "second comment")
      expect(post.reload.comments).to eq([comment2, comment1])
    end
  end
end
</code></pre>

<p>取消 transactions</p>

<pre><code class="ruby">require "rails_helper"

RSpec.configure do |c|
  c.use_transactional_examples = false
  c.order = "defined"
end

describe Widget, :type =&gt; :model do
  it "has none to begin with" do
    expect(Widget.count).to eq 0
  end

  it "has one after adding one" do
    Widget.create
    expect(Widget.count).to eq 1
  end

  # 關閉 transactions，剛剛建立的 Widget 就不會消失
  it "has one after one was created in a previous example" do
    expect(Widget.count).to eq 1
  end

  after(:all) { Widget.destroy_all }
end
</code></pre>

<h2>Routing Specs</h2>

<pre><code class="ruby">describe "posts", :type =&gt; :routing do

  expect(:get =&gt; "/events").to route_to("events#index")
  expect(:get =&gt; "/widgets/1/edit").not_to be_routable

  expect(:get =&gt; "/posts/1").to route_to(
        :controller =&gt; "posts",
        :action =&gt; "show",
        :id =&gt; "1"
        )
end
</code></pre>

<h2>:type => ??</h2>

<p>設定 type 為 controller / model / routing 是 rspec metadata，可以讓 rspec 知道目前的 type</p>

<p>當然也可以在 rails_helper 加入設定，這樣就不需要再每個 spec 檔都加入 type ，只要把檔案放在對應的資料夾，就可以代表該檔案的type</p>

<p>e.g. spec/models -> 認定為 model</p>

<pre><code># rails_helper
config.infer_spec_type_from_file_location!
</code></pre>

<h2>References</h2>

<ul>
<li><a href="http://www.relishapp.com/rspec/rspec-rails/v/3-5/docs">RSpec Rails 3.5</a></li>
<li><a href="http://betterspecs.org/zh_tw/">Better Specs</a></li>
<li><a href="http://motion-express.com/trainings/rspec-rails-1">特快車-RSpec-Rails</a></li>
<li><a href="http://mgleon08.github.io/blog/2016/01/29/rspec-plus-factory-girl/">用 Rspec + Factory Girl + CircleCi 寫測試</a></li>
<li><a href="https://github.com/festime/stubs-mocks-spies-in-rspec">了解 Stubs, Mocks, and Spies</a></li>
<li><a href="https://xdite.gitbooks.io/rspec-101/content/">RSpec on Rails 101</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby Forwardable (Delegator)]]></title>
    <link href="http://rt-tong.com/blog/2017/05/10/ruby-forwardable/"/>
    <updated>2017-05-10T14:02:58+08:00</updated>
    <id>http://rt-tong.com/blog/2017/05/10/ruby-forwardable</id>
    <content type="html"><![CDATA[<!-- more -->


<blockquote><p>ruby method 是一行程式碼且執行動作跟 method_name 相同，就可以使用 forwardable 簡化</p></blockquote>

<h2>語法</h2>

<pre><code># Define method as delegator instance method with an optional alias name ali.
# Method calls to ali will be delegated to accessor.method.
def_instance_delegator(accessor, method, ali = method)

# Shortcut for defining multiple delegator methods,
# but with no provision for using a different name.
def_instance_delegators(accessor, *methods)

# 定義單一個 method, alias for: def_instance_delegator
def_delegator(accessor, method, ali = method)

# 定義多個 methods, alias for: def_instance_delegators
def_delegators(accessor, *methods)
</code></pre>

<h2>範例</h2>

<pre><code># 一般 class Queue
class Queue
  def initialize
    @q = []
  end

  def push(val)
    @q.push(val)
  end
  def shift
    @q.shift
  end
  def size
    @q.size
  end
end

# 使用forwardable 可以把method 優化
require 'forwardable'

class Queue
  extend Forwardable
  def initialize
    @q = []
  end

  def_delegator :@q, :push
  def_delegator :@q, :shift
  def_delegator :@q, :size
end

# 更可以一次宣告多個
class Queue
  extend Forwardable
  def initialize
    @q = []
  end

  def_delegators :@q, :push, :shift, :size
end
</code></pre>

<h2>References</h2>

<ul>
<li><a href="http://ruby-doc.org/stdlib-2.0.0/libdoc/forwardable/rdoc/Forwardable.html">ruby-doc Forwardable</a></li>
<li><a href="https://www.saturnflyer.com/blog/ruby-forwardable-deep-dive">ruby-forwardable-deep-dive</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails 使用CarrierWave 上傳圖片 + 上傳AWS S3]]></title>
    <link href="http://rt-tong.com/blog/2016/09/02/carrierwave-guide-and-integration-aws-s3/"/>
    <updated>2016-09-02T14:09:46+08:00</updated>
    <id>http://rt-tong.com/blog/2016/09/02/carrierwave-guide-and-integration-aws-s3</id>
    <content type="html"><![CDATA[<!-- more -->


<h2>功能介紹</h2>

<h3>修圖軟體</h3>

<ul>
<li><a href="http://imagemagick.org/script/index.php">ImageMagick</a></li>
<li><a href="http://www.graphicsmagick.org/">GraphicsMagick</a></li>
</ul>


<h3>Gems</h3>

<ul>
<li><a href="https://github.com/minimagick/minimagick">MiniMagick</a> 透過Ruby 使用ImageMagick、GraphicsMagick 的gem</li>
<li><a href="https://github.com/rmagick/rmagick">RMagick</a> 透過Ruby 使用ImageMagick</li>
<li><a href="https://github.com/carrierwaveuploader/carrierwave">CarrierWave</a> 上傳檔案的gem</li>
</ul>


<h2>ImageMagick</h2>

<p>需要安裝，否則後面的圖片操作都會失敗</p>

<pre><code>$ brew isntall imagemagick
</code></pre>

<p>檢查是否安裝成功</p>

<pre><code>$ convert -version
Version: ImageMagick 6.8.9-7 Q16 x86_64 2014-09-11 http://www.imagemagick.org
Copyright: Copyright (C) 1999-2014 ImageMagick Studio LLC
Features: DPC Modules
Delegates: bzlib fftw freetype jng jpeg lcms ltdl lzma png tiff xml zlib
</code></pre>

<h2>Install Gems</h2>

<pre><code># Gemfile
# 二擇一
gem 'mini_magick'
# gem 'rmagick'

gem 'carrierwave'

$ bundle install
</code></pre>

<h2>Uploader</h2>

<p>建立uploader，命名爲image （自行決定, e.g.,file, photo &hellip; etc.）</p>

<pre><code>$ rails g uploader image
</code></pre>

<p>設定Uploader</p>

<pre><code># app/uploaders/image_uploader.rb

class ImageUploader &lt; CarrierWave::Uploader::Base

  include CarrierWave::MiniMagick # 指定使用minimagick

  storage :file

  def store_dir
    "uploads/#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}"
  end

  # 指定圖片size (同時產生其他size :thumb, :medium)
  process :resize_to_fit =&gt; [800, 600]

  version :thumb do
    process :resize_to_fill =&gt; [200,120]
  end

  version :medium do
    process :resize_to_fill =&gt; [400,300]
  end

end
</code></pre>

<h2>Model</h2>

<p>建立Model，命名為photo （自行決定, e.g.,file, photo, dog, cat !!?? etc.）</p>

<pre><code>$ rails g model photo image:string
$ rake db:migrate
</code></pre>

<p>設定 model 的uploader</p>

<pre><code># app/models/photo.rb
class Photo &lt; ActiveRecord::Base
  mount_uploader :image, ImageUploader
end
</code></pre>

<h2>gitignore</h2>

<p>排除測試上傳的圖片</p>

<pre><code># .gitignore
public/uploads
</code></pre>

<h1>上傳AWS S3</h1>

<h2>Install Gems</h2>

<pre><code># Gemfile
gem 'fog', group: :production
</code></pre>

<h2>Uploader 設定Production 圖片透過fog 連接並儲存至AWS S3</h2>

<pre><code>if Rails.env.production?
  storage :fog
else
  storage :file
end
</code></pre>

<h2>CarrierWave 加入fog credentials 的設定</h2>

<pre><code># config/initializers/carrier_wave.rb
CarrierWave.configure do |config|
  if Rails.env.production?
    config.storage = :fog
    config.fog_credentials = {
      provider:              'AWS',
      aws_access_key_id:     ENV['AWS_ACCESS_KEY_ID'],
      aws_secret_access_key: ENV['AWS_SECRET_ACCESS_KEY'],
      region:                ENV['AWS_REGION']
    }
    config.fog_directory  =  ENV['AWS_S3_BUCKET_PRODUCTION']
  else
    config.storage :file
  end
end
</code></pre>

<h2>AWS Variables</h2>

<p>列出不同VPS 如何管理AWS 的變數</p>

<ul>
<li>Heroku : Settings > Cofig Variables</li>
<li>AWS: figrao</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby - Nil? | Empty? | Blank?]]></title>
    <link href="http://rt-tong.com/blog/2016/08/24/ruby-nil_empty_blank/"/>
    <updated>2016-08-24T14:09:59+08:00</updated>
    <id>http://rt-tong.com/blog/2016/08/24/ruby-nil_empty_blank</id>
    <content type="html"><![CDATA[<!-- more -->


<h2>nil?</h2>

<p>可使用在任何的<code>object</code>，檢查是否為<code>nil</code>，如果是<code>nil</code>會回傳<code>true</code>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">a</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">str</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'><span class="n">b</span> <span class="o">=</span> <span class="kp">nil</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;a.nil? # false</span>
</span><span class='line'><span class="sr">b.nil? # true</span>
</span></code></pre></td></tr></table></div></figure></p>

<h2>empty?</h2>

<p>可使用在<code>String</code>、<code>Array</code>、<code>Hash</code>，如果為長度為0 會回傳<code>true</code></p>

<p>如果object 是<code>nil</code>，使用empty? 會出現<code>NoMethodError</code>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">a</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'><span class="n">b</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'><span class="n">c</span> <span class="o">=</span> <span class="p">{}</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;p&gt;a.empty? # true</span>
</span><span class='line'><span class="sr">b.empty? # true</span>
</span><span class='line'><span class="sr">c.empty? # true</span>
</span></code></pre></td></tr></table></div></figure></p>

<h2>blank?</h2>

<p>這實作在Rails ，是empty? 的強化版，不受限在<code>String</code>、<code>Array</code>、<code>Hash</code>
<code>
nil.blank?    # true
false.blank?  # true
[].blank?     # true
{}.blank?     # true
"".blank?     # true
5.blank?      # false
0.blank?      # false
</code></p>

<p><strong>But</strong> 如果空白字串，會認定為<code>true</code>
<code>
"  ".blank? # false
"  ".empty? # true
</code></p>

<p>注意：如果陣列的值都是空字串或是nil，會回傳true
<code>
['',nil].blank? # ture
</code></p>

<p>可以使用.all? + blank? 的方式來檢查陣列的值
<code>
['',nil].all? &amp;:blank # true
</code></p>

<h2>present?</h2>

<p>這也是實作在Rails 但跟<code>blank?</code> 的判斷完全顛倒
<code>
nil.present?    # false
false.present?  # false
[].present?     # false
{}.present?     # false
"".present?     # false
5.present?      # true
0.present?      # true
</code></p>

<h2>總結</h2>

<p>剛剛測試的結果，已經有整理成一份表格，可以透過表格查看要使用什麼方式來檢查boolean 值~</p>

<p><img src="/images/posts/2016082401.jpg" alt="nil_empty_blank_present" /></p>
]]></content>
  </entry>
  
</feed>
